# СтройМаркет — автономный каталог

## Быстрый старт

1. Установите зависимости:
   ```bash
   npm install
   ```
2. Экспортируйте API-ключ Gemini в переменную окружения и запустите сервер-прокси:
   ```bash
   GEMINI_API_KEY="ваш-ключ" npm start
   ```
3. Откройте [http://localhost:3000](http://localhost:3000) и работайте с приложением.

> Серверная прокладка скрывает ключ и обрабатывает ошибки API. Браузер обращается только к относительному эндпоинту `/api/generate`.

## Запуск сервера

1. Перед первым запуском обязательно выполните `npm install`, чтобы подтянуть Express.
2. Укажите ключ Gemini в переменной окружения `GEMINI_API_KEY` (в Windows используйте `set GEMINI_API_KEY=...`, в Unix — `export GEMINI_API_KEY=...`).
3. Запустите сервер командой `npm start`. По умолчанию он слушает порт `3000`; переопределить можно через переменную `PORT`.
4. Логи сервера выводятся в консоль процесса. Для остановки используйте `Ctrl+C`.

## Структура

- `index.html` — основной шаблон.
- `app.js` — клиентская логика и рендеринг (включая панель администратора).
- `catalog.js` — экспорт каталога.
- `server.js` — Express-прокси для вызовов Gemini.

## Режим редактирования

1. Откройте сайт с параметром `?edit=1` в адресной строке (например, `http://localhost:3000/?edit=1`). Можно использовать и другие «истинные» значения (`?edit=true`, `?edit=on`) или просто `?edit` без значения. Важно добавлять параметр именно перед хеш-частью URL (то есть `http://localhost:3000/?edit=1#/catalog`, а не `http://localhost:3000/#/?edit=1`). Это разблокирует кнопку «Редактировать» в правом верхнем углу страницы.
2. При первом включении режима система предложит создать локальный PIN (минимум 4 символа). Хэш PIN хранится в `localStorage`, и далее его нужно вводить при каждом включении режима на этом устройстве.
3. После ввода PIN нажмите «Редактировать» — активные элементы (все с классом `.js-editable`) станут доступными для правки текста прямо на странице, а тело документа получит класс `editor-mode` для визуального подсвета редактируемых блоков.
4. В каталоге появятся перетаскиваемые ручки (элементы с классом `.js-drag`), которые позволяют менять порядок категорий и товаров; изменения автоматически сохраняются в локальное хранилище браузера через `localForage`.
5. В панели редактора доступны кнопки «Отменить/Повторить» для локальной истории правок и действия «Экспорт/Импорт JSON». Экспорт скачивает снимок состояния сайта, импорт полностью заменяет текущее состояние (сделайте резервную копию перед загрузкой нового файла).

## Тестирование

Для быстрой проверки, что сервер жив, выполните:
```bash
curl http://localhost:3000/api/health
```
